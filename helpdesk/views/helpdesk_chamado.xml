<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- Form View -->
    <record id="helpdesk_chamado_view_form" model="ir.ui.view">
        <field name="name">Formulário de Chamado</field>
        <field name="model">helpdesk.chamado</field>
        <field name="arch" type="xml">
            <form edit="false" delete="false" create="false" duplicate="false">
                <header>
                    <button name="%(helpdesk.interagir_chamado_wizard)d"  string="Responder Chamado"
                            type="action" class="oe_highlight" context="{'default_status': status}"/>
                    <button name="%(helpdesk.interagir_chamado_cliente_wizard)d"  string="Interação Cliente"
                            type="action" context="{'default_interlocutor': interlocutor, 'default_status': status}"/>
                    <button name="%(helpdesk.designar_chamado_wizard)d"  string="Designar Chamado"
                            type="action" context="{'default_texto': 'x', 'default_atendente_id': atendente_id}"
                            groups="helpdesk.group_helpdesk_gerente"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="data_abertura"/>
                            <field name="cliente_id"/>
                            <field name="item_id"/>
                            <field name="interlocutor"/>
                        </group>
                        <group>
                            <field name="tipo_chamado_id"/>
                            <field name="assunto"/>
                            <field name="status"/>
                            <field name="atendente_id"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Interações">
                            <!-- you can display child data like code below -->
                            <field name="detalhe_chamado_ids">
                                <tree>
                                    <field name="create_date"/>
                                    <field name="responsavel"/>
                                    <field name="texto" string="Detalhamento"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>

    <!-- Tree(list) View -->
    <record id="helpdesk_chamado_view_tree" model="ir.ui.view">
        <field name="name">Lista de chamados</field>
        <field name="model">helpdesk.chamado</field>
        <field name="arch" type="xml">
            <tree create="false" edit="true">
                <field name="id" string="Chamado"/>
                <field name="data_abertura"/>
                <field name="assunto"/>
                <field name="cliente_id"/>
                <field name="item_id"/>
                <field name="atendente_id"/>
                <field name="responsavel"/>
                <field name="tipo_chamado_id"/>
                <field name="status"/>
            </tree>
        </field>
    </record>

    <record id="helpdesk_chamado_cliente_view_form" model="ir.ui.view">
        <field name="name">Formulário de Chamado</field>
        <field name="model">helpdesk.chamado</field>
        <field name="arch" type="xml">
            <form edit="false" delete="false" create="false" duplicate="false">
                <header>
                    <button name="%(helpdesk.interagir_chamado_usu_cliente_wizard)d"  string="Responder Chamado"
                            type="action" class="oe_highlight" context="{'default_status': status}"/>
                </header>
                <sheet>
                    <group>
                        <group>
                            <field name="data_abertura"/>
                            <field name="cliente_id"/>
                            <field name="item_id"/>
                            <field name="interlocutor"/>
                        </group>
                        <group>
                            <field name="tipo_chamado_id"/>
                            <field name="assunto"/>
                            <field name="status"/>
                            <field name="atendente_id"/>
                        </group>
                    </group>

                    <notebook>
                        <page string="Interações">
                            <!-- you can display child data like code below -->
                            <field name="detalhe_chamado_ids">
                                <tree edit="false">
                                    <field name="create_date" attrs="{'string':'Dt. Criação'}"/>
                                    <field name="responsavel"/>
                                    <field name="texto" string="Detalhamento"/>
                                </tree>
                            </field>
                        </page>
                    </notebook>

                </sheet>
            </form>
        </field>
    </record>

    <!-- Tree(list) View -->
    <record id="helpdesk_chamado_cliente_view_tree" model="ir.ui.view">
        <field name="name">Lista de chamados</field>
        <field name="model">helpdesk.chamado</field>
        <field name="arch" type="xml">
            <tree create="false">
                <field name="id"/>
<!--                <field name="empresa_usuario"/>-->
                <field name="data_abertura"/>
                <field name="assunto"/>
                <field name="cliente_id"/>
                <field name="item_id"/>
                <field name="responsavel"/>
                <field name="atendente_id"/>
                <field name="tipo_chamado_id"/>
                <field name="status"/>
                <field name="create_uid"/>
            </tree>
        </field>
    </record>

    <!-- Search View -->
    <record id="helpdesk_chamado_search" model="ir.ui.view">
        <field name="name">helpdesk.chamado.search</field>
        <field name="model">helpdesk.chamado</field>
        <field name="arch" type="xml">
            <search string="Chamados">
                <field name="data_abertura"/>
                <separator/>
                <filter string="Meus Chamados" name="meus_chamados"
                        domain="['|','&amp;',('atendente_id', '=', uid),('status', 'in',
                                ['aguardando_atendente', 'em_atendimento']),('status', '=', 'pendente')]"
                        groups="helpdesk.group_helpdesk_atendente,helpdesk.group_helpdesk_gerente"/>
                <filter string="Chamados Gerente" name="chamados_gerente"
                        domain="[('status', 'in', ['pendente', 'aguardando_gerente'])]"
                        groups="helpdesk.group_helpdesk_gerente"/>
                <filter string="Aguardando Atendente" name="chamados_aguardando_atendente"
                        domain="[('status', '=', 'aguardando_atendente')]"
                        groups="helpdesk.group_helpdesk_gerente"/>
                <filter string="Ativos" name="chamados_cliente"
                        domain="[('status', 'not in', ['resolvido','rejeitado'])]"
                        groups="helpdesk.group_helpdesk_cliente"/>
                <group expand="1" string="Agrupamento">
                    <filter string="Atendente" name="agrup_atendente" context="{'group_by':'atendente_id'}"
                            groups="helpdesk.group_helpdesk_gerente"/>
                </group>
            </search>
        </field>
    </record>


    <!-- Act Window -->
    <record id='helpdesk_chamado_action' model='ir.actions.act_window'>
        <field name="name">Chamados</field>
        <field name="res_model">helpdesk.chamado</field>
        <field name="context">{'search_default_chamados_gerente': 1}</field>
    </record>

    <record id='helpdesk_chamado_cliente_action' model='ir.actions.act_window'>
        <field name="name">Chamados</field>
        <field name="res_model">helpdesk.chamado</field>
        <field name="context">{'search_default_chamados_cliente': 1}</field>
        <field name="domain">[]</field>
    </record>

    <!-- O record abaixo é do tipo server. Serve para criar uma chamada a uma função Python -->
    <record id="helpdesk_chamado_filtro_atendente_server" model="ir.actions.server">
        <field name="name">Chamados - Atendente</field>
        <field name="model_id" ref="helpdesk.model_helpdesk_chamado"/>
        <field name="state">code</field>
        <field name="code">action = model.filtrar_chamado_atendente()</field>
    </record>

    <!-- Act Window View -->
    <record id="link_helpdesk_chamado_tree" model="ir.actions.act_window.view">
        <field name="sequence" eval="10"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="helpdesk_chamado_view_tree"/>
        <field name="act_window_id" ref="helpdesk_chamado_action"/>
    </record>

    <record id="link_helpdesk_chamado_form" model="ir.actions.act_window.view">
        <field name="sequence" eval="20"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="helpdesk_chamado_view_form"/>
        <field name="act_window_id" ref="helpdesk_chamado_action"/>
    </record>

    <record id="link_helpdesk_chamado_cliente_tree" model="ir.actions.act_window.view">
        <field name="sequence" eval="10"/>
        <field name="view_mode">tree</field>
        <field name="view_id" ref="helpdesk_chamado_cliente_view_tree"/>
        <field name="act_window_id" ref="helpdesk_chamado_cliente_action"/>
    </record>

    <record id="link_helpdesk_chamado_cliente_form" model="ir.actions.act_window.view">
        <field name="sequence" eval="20"/>
        <field name="view_mode">form</field>
        <field name="view_id" ref="helpdesk_chamado_cliente_view_form"/>
        <field name="act_window_id" ref="helpdesk_chamado_cliente_action"/>
    </record>

</odoo>

